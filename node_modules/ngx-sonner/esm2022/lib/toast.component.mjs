import { NgComponentOutlet } from '@angular/common';
import { ChangeDetectionStrategy, Component, computed, effect, input, signal, untracked, viewChild, } from '@angular/core';
import { cn } from './internal/cn';
import { defaultClasses, GAP, SWIPE_THRESHOLD, TIME_BEFORE_UNMOUNT, TOAST_LIFETIME, } from './internal/constants';
import { AsComponentPipe } from './pipes/as-component.pipe';
import { IsStringPipe } from './pipes/is-string.pipe';
import { toastState } from './state';
import * as i0 from "@angular/core";
export class ToastComponent {
    constructor() {
        this.cn = cn;
        this.toasts = toastState.toasts;
        this.heights = toastState.heights;
        this.removeHeight = toastState.removeHeight;
        this.addHeight = toastState.addHeight;
        this.dismiss = toastState.dismiss;
        this.toast = input.required();
        this.index = input.required();
        this.expanded = input.required();
        this._invert = input.required({ alias: 'invert' });
        this.position = input.required();
        this.visibleToasts = input.required();
        this.expandByDefault = input.required();
        this._closeButton = input.required({
            alias: 'closeButton',
        });
        this.interacting = input.required();
        this.cancelButtonStyle = input();
        this.actionButtonStyle = input();
        this.duration = input(TOAST_LIFETIME);
        this.descriptionClass = input('');
        this._classes = input({}, { alias: 'classes' });
        this.unstyled = input(false);
        this._class = input('', { alias: 'class' });
        this._style = input({}, { alias: 'style' });
        this.mounted = signal(false);
        this.removed = signal(false);
        this.swiping = signal(false);
        this.swipeOut = signal(false);
        this.offsetBeforeRemove = signal(0);
        this.initialHeight = signal(0);
        this.toastRef = viewChild.required('toastRef');
        this.classes = computed(() => ({
            ...defaultClasses,
            ...this._classes(),
        }));
        this.isFront = computed(() => this.index() === 0);
        this.isVisible = computed(() => this.index() + 1 <= this.visibleToasts());
        this.toastType = computed(() => this.toast().type ?? 'default');
        this.toastClass = computed(() => this.toast().class ?? '');
        this.toastDescriptionClass = computed(() => this.toast().descriptionClass ?? '');
        this.heightIndex = computed(() => this.heights().findIndex(height => height.toastId === this.toast().id));
        this.offset = signal(0);
        this.closeTimerStartTimeRef = 0;
        this.lastCloseTimerStartTimeRef = 0;
        this.pointerStartRef = null;
        this.coords = computed(() => this.position().split('-'));
        this.toastsHeightBefore = computed(() => this.heights().reduce((prev, curr, reducerIndex) => {
            if (reducerIndex >= this.heightIndex())
                return prev;
            return prev + curr.height;
        }, 0));
        this.invert = computed(() => this.toast().invert ?? this._invert());
        this.closeButton = computed(() => this.toast().closeButton ?? this._closeButton());
        this.disabled = computed(() => this.toastType() === 'loading');
        this.remainingTime = 0;
        this.isPromiseLoadingOrInfiniteDuration = computed(() => (this.toast().promise && this.toastType() === 'loading') ||
            this.toast().duration === Number.POSITIVE_INFINITY);
        this.toastClasses = computed(() => cn(this._class(), this.toastClass(), this.classes().toast, this.toast().classes?.toast, this.classes()[this.toastType()], this.toast().classes?.[this.toastType()]));
        this.toastStyle = computed(() => ({
            '--index': `${this.index()}`,
            '--toasts-before': `${this.index()}`,
            '--z-index': `${this.toasts().length - this.index()}`,
            '--offset': `${this.removed() ? this.offsetBeforeRemove() : this.offset()}px`,
            '--initial-height': this.expandByDefault()
                ? 'auto'
                : `${this.initialHeight()}px`,
            ...this._style(),
        }));
        effect(() => {
            const heightIndex = this.heightIndex();
            const toastsHeightBefore = this.toastsHeightBefore();
            untracked(() => this.offset.set(Math.round(heightIndex * GAP + toastsHeightBefore)));
        });
        effect(() => {
            if (this.toast().updated) {
                // if the toast has been updated after the initial render,
                // we want to reset the timer and set the remaining time to the
                // new duration
                clearTimeout(this.timeoutId);
                this.remainingTime =
                    this.toast().duration ?? this.duration() ?? TOAST_LIFETIME;
                this.startTimer();
            }
        });
        effect(onCleanup => {
            if (!this.isPromiseLoadingOrInfiniteDuration()) {
                if (this.expanded() || this.interacting()) {
                    this.pauseTimer();
                }
                else {
                    this.startTimer();
                }
            }
            onCleanup(() => clearTimeout(this.timeoutId));
        });
        effect(() => {
            if (this.toast().delete) {
                this.deleteToast();
            }
        });
    }
    ngAfterViewInit() {
        this.remainingTime =
            this.toast().duration ?? this.duration() ?? TOAST_LIFETIME;
        this.mounted.set(true);
        const height = this.toastRef().nativeElement.getBoundingClientRect().height;
        this.initialHeight.set(height);
        this.addHeight({ toastId: this.toast().id, height });
    }
    ngOnDestroy() {
        clearTimeout(this.timeoutId);
        this.removeHeight(this.toast().id);
    }
    deleteToast() {
        this.removed.set(true);
        this.offsetBeforeRemove.set(this.offset());
        this.removeHeight(this.toast().id);
        setTimeout(() => {
            this.dismiss(this.toast().id);
        }, TIME_BEFORE_UNMOUNT);
    }
    // If toast's duration changes, it will be out of sync with the
    // remainingAtTimeout, so we know we need to restart the timer
    // with the new duration
    // Pause the timer on each hover
    pauseTimer() {
        if (this.lastCloseTimerStartTimeRef < this.closeTimerStartTimeRef) {
            // Get the elapsed time since the timer started
            const elapsedTime = new Date().getTime() - this.closeTimerStartTimeRef;
            this.remainingTime = this.remainingTime - elapsedTime;
        }
        this.lastCloseTimerStartTimeRef = new Date().getTime();
    }
    startTimer() {
        this.closeTimerStartTimeRef = new Date().getTime();
        // Let the toast know it has started
        this.timeoutId = setTimeout(() => {
            this.toast().onAutoClose?.(this.toast());
            this.deleteToast();
        }, this.remainingTime);
    }
    onPointerDown(event) {
        if (this.disabled() || !this.toast().dismissible)
            return;
        this.offsetBeforeRemove.set(this.offset());
        const target = event.target;
        // Ensure we maintain correct pointer capture even when going outside the toast (e.g. when swiping)
        target.setPointerCapture(event.pointerId);
        if (target.tagName === 'BUTTON') {
            return;
        }
        this.swiping.set(true);
        this.pointerStartRef = { x: event.clientX, y: event.clientY };
    }
    onPointerUp() {
        if (this.swipeOut() || !this.toast().dismissible)
            return;
        this.pointerStartRef = null;
        const swipeAmount = Number(this.toastRef()
            .nativeElement.style.getPropertyValue('--swipe-amount')
            .replace('px', '') || 0);
        // Remove only if threshold is met
        if (Math.abs(swipeAmount) >= SWIPE_THRESHOLD) {
            this.offsetBeforeRemove.set(this.offset());
            this.toast().onDismiss?.(this.toast());
            this.deleteToast();
            this.swipeOut.set(true);
            return;
        }
        this.toastRef().nativeElement.style.setProperty('--swipe-amount', '0px');
        this.swiping.set(false);
    }
    onPointerMove(event) {
        if (!this.pointerStartRef || !this.toast().dismissible)
            return;
        const yPosition = event.clientY - this.pointerStartRef.y;
        const xPosition = event.clientX - this.pointerStartRef.x;
        const clamp = this.coords()[0] === 'top' ? Math.min : Math.max;
        const clampedY = clamp(0, yPosition);
        const swipeStartThreshold = event.pointerType === 'touch' ? 10 : 2;
        const isAllowedToSwipe = Math.abs(clampedY) > swipeStartThreshold;
        if (isAllowedToSwipe) {
            this.toastRef().nativeElement.style.setProperty('--swipe-amount', `${yPosition}px`);
        }
        else if (Math.abs(xPosition) > swipeStartThreshold) {
            // User is swiping in wrong direction, so we disable swipe gesture
            // for the current pointer down interaction
            this.pointerStartRef = null;
        }
    }
    onCloseButtonClick() {
        if (this.disabled() || !this.toast().dismissible)
            return;
        this.deleteToast();
        this.toast().onDismiss?.(this.toast());
    }
    onCancelClick() {
        const toast = this.toast();
        if (!toast.dismissible)
            return;
        this.deleteToast();
        if (toast.cancel?.onClick) {
            toast.cancel.onClick();
        }
    }
    onActionClick(event) {
        const toast = this.toast();
        toast.action?.onClick(event);
        if (event.defaultPrevented)
            return;
        this.deleteToast();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: ToastComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.0.1", type: ToastComponent, isStandalone: true, selector: "ngx-sonner-toast", inputs: { toast: { classPropertyName: "toast", publicName: "toast", isSignal: true, isRequired: true, transformFunction: null }, index: { classPropertyName: "index", publicName: "index", isSignal: true, isRequired: true, transformFunction: null }, expanded: { classPropertyName: "expanded", publicName: "expanded", isSignal: true, isRequired: true, transformFunction: null }, _invert: { classPropertyName: "_invert", publicName: "invert", isSignal: true, isRequired: true, transformFunction: null }, position: { classPropertyName: "position", publicName: "position", isSignal: true, isRequired: true, transformFunction: null }, visibleToasts: { classPropertyName: "visibleToasts", publicName: "visibleToasts", isSignal: true, isRequired: true, transformFunction: null }, expandByDefault: { classPropertyName: "expandByDefault", publicName: "expandByDefault", isSignal: true, isRequired: true, transformFunction: null }, _closeButton: { classPropertyName: "_closeButton", publicName: "closeButton", isSignal: true, isRequired: true, transformFunction: null }, interacting: { classPropertyName: "interacting", publicName: "interacting", isSignal: true, isRequired: true, transformFunction: null }, cancelButtonStyle: { classPropertyName: "cancelButtonStyle", publicName: "cancelButtonStyle", isSignal: true, isRequired: false, transformFunction: null }, actionButtonStyle: { classPropertyName: "actionButtonStyle", publicName: "actionButtonStyle", isSignal: true, isRequired: false, transformFunction: null }, duration: { classPropertyName: "duration", publicName: "duration", isSignal: true, isRequired: false, transformFunction: null }, descriptionClass: { classPropertyName: "descriptionClass", publicName: "descriptionClass", isSignal: true, isRequired: false, transformFunction: null }, _classes: { classPropertyName: "_classes", publicName: "classes", isSignal: true, isRequired: false, transformFunction: null }, unstyled: { classPropertyName: "unstyled", publicName: "unstyled", isSignal: true, isRequired: false, transformFunction: null }, _class: { classPropertyName: "_class", publicName: "class", isSignal: true, isRequired: false, transformFunction: null }, _style: { classPropertyName: "_style", publicName: "style", isSignal: true, isRequired: false, transformFunction: null } }, viewQueries: [{ propertyName: "toastRef", first: true, predicate: ["toastRef"], descendants: true, isSignal: true }], ngImport: i0, template: `
    <li
      #toastRef
      data-sonner-toast
      [attr.aria-live]="toast().important ? 'assertive' : 'polite'"
      aria-atomic="true"
      role="status"
      tabindex="0"
      [class]="toastClasses()"
      [attr.data-styled]="
        !(toast().component || toast().unstyled || unstyled())
      "
      [attr.data-mounted]="mounted()"
      [attr.data-promise]="!!toast().promise"
      [attr.data-removed]="removed()"
      [attr.data-visible]="isVisible()"
      [attr.data-y-position]="coords()[0]"
      [attr.data-x-position]="coords()[1]"
      [attr.data-index]="index()"
      [attr.data-front]="isFront()"
      [attr.data-swiping]="swiping()"
      [attr.data-dismissible]="toast().dismissible"
      [attr.data-type]="toastType()"
      [attr.data-invert]="invert()"
      [attr.data-swipe-out]="swipeOut()"
      [attr.data-expanded]="expanded() || (expandByDefault() && mounted())"
      [style]="toastStyle()"
      (pointerdown)="onPointerDown($event)"
      (pointerup)="onPointerUp()"
      (pointermove)="onPointerMove($event)">
      @if (closeButton() && !toast().component) {
        <button
          aria-label="Close toast"
          [attr.data-disabled]="disabled()"
          data-close-button
          (click)="onCloseButtonClick()"
          [class]="cn(classes().closeButton, toast().classes?.closeButton)">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      }

      @if (toast().component) {
        <ng-container
          *ngComponentOutlet="
            toast().component | asComponent;
            inputs: toast().componentProps
          " />
      } @else {
        @if (toastType() !== 'default' || toast().icon || toast().promise) {
          <div data-icon>
            @if (toastType() === 'loading' && !toast().icon) {
              <ng-content select="[loading-icon]" />
            }
            @if (toast().icon) {
              <ng-container
                *ngComponentOutlet="
                  toast().icon | asComponent;
                  inputs: toast().componentProps
                " />
            } @else {
              @switch (toastType()) {
                @case ('success') {
                  <ng-content select="[success-icon]" />
                }
                @case ('error') {
                  <ng-content select="[error-icon]" />
                }
                @case ('warning') {
                  <ng-content select="[warning-icon]" />
                }
                @case ('info') {
                  <ng-content select="[info-icon]" />
                }
              }
            }
          </div>
        }
        <div data-content>
          @if (toast().title; as title) {
            <div
              data-title
              [class]="cn(classes().title, toast().classes?.title)">
              @if (title | isString) {
                {{ toast().title }}
              } @else {
                <ng-container
                  *ngComponentOutlet="
                    title | asComponent;
                    inputs: toast().componentProps
                  " />
              }
            </div>
          }
          @if (toast().description; as description) {
            <div
              data-description
              [class]="
                cn(
                  descriptionClass(),
                  toastDescriptionClass(),
                  classes().description,
                  toast().classes?.description
                )
              ">
              @if (description | isString) {
                {{ toast().description }}
              } @else {
                <ng-container
                  *ngComponentOutlet="
                    description | asComponent;
                    inputs: toast().componentProps
                  " />
              }
            </div>
          }
        </div>
        @if (toast().cancel; as cancel) {
          <button
            data-button
            data-cancel
            [style]="cancelButtonStyle() ?? toast().cancelButtonStyle"
            [class]="cn(classes().cancelButton, toast().classes?.cancelButton)"
            (click)="onCancelClick()">
            {{ cancel.label }}
          </button>
        }
        @if (toast().action; as action) {
          <button
            data-button
            [style]="actionButtonStyle() ?? toast().actionButtonStyle"
            [class]="cn(classes().actionButton, toast().classes?.actionButton)"
            (click)="onActionClick($event)">
            {{ action.label }}
          </button>
        }
      }
    </li>
  `, isInline: true, dependencies: [{ kind: "directive", type: NgComponentOutlet, selector: "[ngComponentOutlet]", inputs: ["ngComponentOutlet", "ngComponentOutletInputs", "ngComponentOutletInjector", "ngComponentOutletContent", "ngComponentOutletNgModule", "ngComponentOutletNgModuleFactory"] }, { kind: "pipe", type: IsStringPipe, name: "isString" }, { kind: "pipe", type: AsComponentPipe, name: "asComponent" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: ToastComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngx-sonner-toast',
                    standalone: true,
                    imports: [NgComponentOutlet, IsStringPipe, AsComponentPipe],
                    template: `
    <li
      #toastRef
      data-sonner-toast
      [attr.aria-live]="toast().important ? 'assertive' : 'polite'"
      aria-atomic="true"
      role="status"
      tabindex="0"
      [class]="toastClasses()"
      [attr.data-styled]="
        !(toast().component || toast().unstyled || unstyled())
      "
      [attr.data-mounted]="mounted()"
      [attr.data-promise]="!!toast().promise"
      [attr.data-removed]="removed()"
      [attr.data-visible]="isVisible()"
      [attr.data-y-position]="coords()[0]"
      [attr.data-x-position]="coords()[1]"
      [attr.data-index]="index()"
      [attr.data-front]="isFront()"
      [attr.data-swiping]="swiping()"
      [attr.data-dismissible]="toast().dismissible"
      [attr.data-type]="toastType()"
      [attr.data-invert]="invert()"
      [attr.data-swipe-out]="swipeOut()"
      [attr.data-expanded]="expanded() || (expandByDefault() && mounted())"
      [style]="toastStyle()"
      (pointerdown)="onPointerDown($event)"
      (pointerup)="onPointerUp()"
      (pointermove)="onPointerMove($event)">
      @if (closeButton() && !toast().component) {
        <button
          aria-label="Close toast"
          [attr.data-disabled]="disabled()"
          data-close-button
          (click)="onCloseButtonClick()"
          [class]="cn(classes().closeButton, toast().classes?.closeButton)">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      }

      @if (toast().component) {
        <ng-container
          *ngComponentOutlet="
            toast().component | asComponent;
            inputs: toast().componentProps
          " />
      } @else {
        @if (toastType() !== 'default' || toast().icon || toast().promise) {
          <div data-icon>
            @if (toastType() === 'loading' && !toast().icon) {
              <ng-content select="[loading-icon]" />
            }
            @if (toast().icon) {
              <ng-container
                *ngComponentOutlet="
                  toast().icon | asComponent;
                  inputs: toast().componentProps
                " />
            } @else {
              @switch (toastType()) {
                @case ('success') {
                  <ng-content select="[success-icon]" />
                }
                @case ('error') {
                  <ng-content select="[error-icon]" />
                }
                @case ('warning') {
                  <ng-content select="[warning-icon]" />
                }
                @case ('info') {
                  <ng-content select="[info-icon]" />
                }
              }
            }
          </div>
        }
        <div data-content>
          @if (toast().title; as title) {
            <div
              data-title
              [class]="cn(classes().title, toast().classes?.title)">
              @if (title | isString) {
                {{ toast().title }}
              } @else {
                <ng-container
                  *ngComponentOutlet="
                    title | asComponent;
                    inputs: toast().componentProps
                  " />
              }
            </div>
          }
          @if (toast().description; as description) {
            <div
              data-description
              [class]="
                cn(
                  descriptionClass(),
                  toastDescriptionClass(),
                  classes().description,
                  toast().classes?.description
                )
              ">
              @if (description | isString) {
                {{ toast().description }}
              } @else {
                <ng-container
                  *ngComponentOutlet="
                    description | asComponent;
                    inputs: toast().componentProps
                  " />
              }
            </div>
          }
        </div>
        @if (toast().cancel; as cancel) {
          <button
            data-button
            data-cancel
            [style]="cancelButtonStyle() ?? toast().cancelButtonStyle"
            [class]="cn(classes().cancelButton, toast().classes?.cancelButton)"
            (click)="onCancelClick()">
            {{ cancel.label }}
          </button>
        }
        @if (toast().action; as action) {
          <button
            data-button
            [style]="actionButtonStyle() ?? toast().actionButtonStyle"
            [class]="cn(classes().actionButton, toast().classes?.actionButton)"
            (click)="onActionClick($event)">
            {{ action.label }}
          </button>
        }
      }
    </li>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtc29ubmVyL3NyYy9saWIvdG9hc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFFBQVEsRUFDUixNQUFNLEVBRU4sS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkMsT0FBTyxFQUNMLGNBQWMsRUFDZCxHQUFHLEVBQ0gsZUFBZSxFQUNmLG1CQUFtQixFQUNuQixjQUFjLEdBQ2YsTUFBTSxzQkFBc0IsQ0FBQztBQUM5QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxTQUFTLENBQUM7O0FBK0pyQyxNQUFNLE9BQU8sY0FBYztJQW9HekI7UUFuR21CLE9BQUUsR0FBRyxFQUFFLENBQUM7UUFFM0IsV0FBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUM7UUFDM0IsWUFBTyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUM7UUFDN0IsaUJBQVksR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDO1FBQ3ZDLGNBQVMsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDO1FBQ2pDLFlBQU8sR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDO1FBRTdCLFVBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxFQUF1QixDQUFDO1FBQzlDLFVBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxFQUF1QixDQUFDO1FBQzlDLGFBQVEsR0FB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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBcUpULDREQXRKUyxpQkFBaUIsK09BQUUsWUFBWSw0Q0FBRSxlQUFlOzsyRkF5Si9DLGNBQWM7a0JBNUoxQixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLFVBQVUsRUFBRSxJQUFJO29CQUNoQixPQUFPLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsZUFBZSxDQUFDO29CQUMzRCxRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBcUpUO29CQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nQ29tcG9uZW50T3V0bGV0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIGNvbXB1dGVkLFxuICBlZmZlY3QsXG4gIEVsZW1lbnRSZWYsXG4gIGlucHV0LFxuICBPbkRlc3Ryb3ksXG4gIHNpZ25hbCxcbiAgdW50cmFja2VkLFxuICB2aWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgY24gfSBmcm9tICcuL2ludGVybmFsL2NuJztcbmltcG9ydCB7XG4gIGRlZmF1bHRDbGFzc2VzLFxuICBHQVAsXG4gIFNXSVBFX1RIUkVTSE9MRCxcbiAgVElNRV9CRUZPUkVfVU5NT1VOVCxcbiAgVE9BU1RfTElGRVRJTUUsXG59IGZyb20gJy4vaW50ZXJuYWwvY29uc3RhbnRzJztcbmltcG9ydCB7IEFzQ29tcG9uZW50UGlwZSB9IGZyb20gJy4vcGlwZXMvYXMtY29tcG9uZW50LnBpcGUnO1xuaW1wb3J0IHsgSXNTdHJpbmdQaXBlIH0gZnJvbSAnLi9waXBlcy9pcy1zdHJpbmcucGlwZSc7XG5pbXBvcnQgeyB0b2FzdFN0YXRlIH0gZnJvbSAnLi9zdGF0ZSc7XG5pbXBvcnQgeyBUb2FzdFByb3BzIH0gZnJvbSAnLi90eXBlcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1zb25uZXItdG9hc3QnLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbTmdDb21wb25lbnRPdXRsZXQsIElzU3RyaW5nUGlwZSwgQXNDb21wb25lbnRQaXBlXSxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bGlcbiAgICAgICN0b2FzdFJlZlxuICAgICAgZGF0YS1zb25uZXItdG9hc3RcbiAgICAgIFthdHRyLmFyaWEtbGl2ZV09XCJ0b2FzdCgpLmltcG9ydGFudCA/ICdhc3NlcnRpdmUnIDogJ3BvbGl0ZSdcIlxuICAgICAgYXJpYS1hdG9taWM9XCJ0cnVlXCJcbiAgICAgIHJvbGU9XCJzdGF0dXNcIlxuICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgIFtjbGFzc109XCJ0b2FzdENsYXNzZXMoKVwiXG4gICAgICBbYXR0ci5kYXRhLXN0eWxlZF09XCJcbiAgICAgICAgISh0b2FzdCgpLmNvbXBvbmVudCB8fCB0b2FzdCgpLnVuc3R5bGVkIHx8IHVuc3R5bGVkKCkpXG4gICAgICBcIlxuICAgICAgW2F0dHIuZGF0YS1tb3VudGVkXT1cIm1vdW50ZWQoKVwiXG4gICAgICBbYXR0ci5kYXRhLXByb21pc2VdPVwiISF0b2FzdCgpLnByb21pc2VcIlxuICAgICAgW2F0dHIuZGF0YS1yZW1vdmVkXT1cInJlbW92ZWQoKVwiXG4gICAgICBbYXR0ci5kYXRhLXZpc2libGVdPVwiaXNWaXNpYmxlKClcIlxuICAgICAgW2F0dHIuZGF0YS15LXBvc2l0aW9uXT1cImNvb3JkcygpWzBdXCJcbiAgICAgIFthdHRyLmRhdGEteC1wb3NpdGlvbl09XCJjb29yZHMoKVsxXVwiXG4gICAgICBbYXR0ci5kYXRhLWluZGV4XT1cImluZGV4KClcIlxuICAgICAgW2F0dHIuZGF0YS1mcm9udF09XCJpc0Zyb250KClcIlxuICAgICAgW2F0dHIuZGF0YS1zd2lwaW5nXT1cInN3aXBpbmcoKVwiXG4gICAgICBbYXR0ci5kYXRhLWRpc21pc3NpYmxlXT1cInRvYXN0KCkuZGlzbWlzc2libGVcIlxuICAgICAgW2F0dHIuZGF0YS10eXBlXT1cInRvYXN0VHlwZSgpXCJcbiAgICAgIFthdHRyLmRhdGEtaW52ZXJ0XT1cImludmVydCgpXCJcbiAgICAgIFthdHRyLmRhdGEtc3dpcGUtb3V0XT1cInN3aXBlT3V0KClcIlxuICAgICAgW2F0dHIuZGF0YS1leHBhbmRlZF09XCJleHBhbmRlZCgpIHx8IChleHBhbmRCeURlZmF1bHQoKSAmJiBtb3VudGVkKCkpXCJcbiAgICAgIFtzdHlsZV09XCJ0b2FzdFN0eWxlKClcIlxuICAgICAgKHBvaW50ZXJkb3duKT1cIm9uUG9pbnRlckRvd24oJGV2ZW50KVwiXG4gICAgICAocG9pbnRlcnVwKT1cIm9uUG9pbnRlclVwKClcIlxuICAgICAgKHBvaW50ZXJtb3ZlKT1cIm9uUG9pbnRlck1vdmUoJGV2ZW50KVwiPlxuICAgICAgQGlmIChjbG9zZUJ1dHRvbigpICYmICF0b2FzdCgpLmNvbXBvbmVudCkge1xuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgYXJpYS1sYWJlbD1cIkNsb3NlIHRvYXN0XCJcbiAgICAgICAgICBbYXR0ci5kYXRhLWRpc2FibGVkXT1cImRpc2FibGVkKClcIlxuICAgICAgICAgIGRhdGEtY2xvc2UtYnV0dG9uXG4gICAgICAgICAgKGNsaWNrKT1cIm9uQ2xvc2VCdXR0b25DbGljaygpXCJcbiAgICAgICAgICBbY2xhc3NdPVwiY24oY2xhc3NlcygpLmNsb3NlQnV0dG9uLCB0b2FzdCgpLmNsYXNzZXM/LmNsb3NlQnV0dG9uKVwiPlxuICAgICAgICAgIDxzdmdcbiAgICAgICAgICAgIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIlxuICAgICAgICAgICAgd2lkdGg9XCIxMlwiXG4gICAgICAgICAgICBoZWlnaHQ9XCIxMlwiXG4gICAgICAgICAgICB2aWV3Qm94PVwiMCAwIDI0IDI0XCJcbiAgICAgICAgICAgIGZpbGw9XCJub25lXCJcbiAgICAgICAgICAgIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiXG4gICAgICAgICAgICBzdHJva2Utd2lkdGg9XCIxLjVcIlxuICAgICAgICAgICAgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiXG4gICAgICAgICAgICBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPlxuICAgICAgICAgICAgPGxpbmUgeDE9XCIxOFwiIHkxPVwiNlwiIHgyPVwiNlwiIHkyPVwiMThcIiAvPlxuICAgICAgICAgICAgPGxpbmUgeDE9XCI2XCIgeTE9XCI2XCIgeDI9XCIxOFwiIHkyPVwiMThcIiAvPlxuICAgICAgICAgIDwvc3ZnPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIH1cblxuICAgICAgQGlmICh0b2FzdCgpLmNvbXBvbmVudCkge1xuICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgKm5nQ29tcG9uZW50T3V0bGV0PVwiXG4gICAgICAgICAgICB0b2FzdCgpLmNvbXBvbmVudCB8IGFzQ29tcG9uZW50O1xuICAgICAgICAgICAgaW5wdXRzOiB0b2FzdCgpLmNvbXBvbmVudFByb3BzXG4gICAgICAgICAgXCIgLz5cbiAgICAgIH0gQGVsc2Uge1xuICAgICAgICBAaWYgKHRvYXN0VHlwZSgpICE9PSAnZGVmYXVsdCcgfHwgdG9hc3QoKS5pY29uIHx8IHRvYXN0KCkucHJvbWlzZSkge1xuICAgICAgICAgIDxkaXYgZGF0YS1pY29uPlxuICAgICAgICAgICAgQGlmICh0b2FzdFR5cGUoKSA9PT0gJ2xvYWRpbmcnICYmICF0b2FzdCgpLmljb24pIHtcbiAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW2xvYWRpbmctaWNvbl1cIiAvPlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgQGlmICh0b2FzdCgpLmljb24pIHtcbiAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgICAgICpuZ0NvbXBvbmVudE91dGxldD1cIlxuICAgICAgICAgICAgICAgICAgdG9hc3QoKS5pY29uIHwgYXNDb21wb25lbnQ7XG4gICAgICAgICAgICAgICAgICBpbnB1dHM6IHRvYXN0KCkuY29tcG9uZW50UHJvcHNcbiAgICAgICAgICAgICAgICBcIiAvPlxuICAgICAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgICAgIEBzd2l0Y2ggKHRvYXN0VHlwZSgpKSB7XG4gICAgICAgICAgICAgICAgQGNhc2UgKCdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3N1Y2Nlc3MtaWNvbl1cIiAvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBAY2FzZSAoJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW2Vycm9yLWljb25dXCIgLz5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgQGNhc2UgKCd3YXJuaW5nJykge1xuICAgICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3dhcm5pbmctaWNvbl1cIiAvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBAY2FzZSAoJ2luZm8nKSB7XG4gICAgICAgICAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbaW5mby1pY29uXVwiIC8+XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIH1cbiAgICAgICAgPGRpdiBkYXRhLWNvbnRlbnQ+XG4gICAgICAgICAgQGlmICh0b2FzdCgpLnRpdGxlOyBhcyB0aXRsZSkge1xuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBkYXRhLXRpdGxlXG4gICAgICAgICAgICAgIFtjbGFzc109XCJjbihjbGFzc2VzKCkudGl0bGUsIHRvYXN0KCkuY2xhc3Nlcz8udGl0bGUpXCI+XG4gICAgICAgICAgICAgIEBpZiAodGl0bGUgfCBpc1N0cmluZykge1xuICAgICAgICAgICAgICAgIHt7IHRvYXN0KCkudGl0bGUgfX1cbiAgICAgICAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgKm5nQ29tcG9uZW50T3V0bGV0PVwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlIHwgYXNDb21wb25lbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0czogdG9hc3QoKS5jb21wb25lbnRQcm9wc1xuICAgICAgICAgICAgICAgICAgXCIgLz5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgfVxuICAgICAgICAgIEBpZiAodG9hc3QoKS5kZXNjcmlwdGlvbjsgYXMgZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgZGF0YS1kZXNjcmlwdGlvblxuICAgICAgICAgICAgICBbY2xhc3NdPVwiXG4gICAgICAgICAgICAgICAgY24oXG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbkNsYXNzKCksXG4gICAgICAgICAgICAgICAgICB0b2FzdERlc2NyaXB0aW9uQ2xhc3MoKSxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXMoKS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgIHRvYXN0KCkuY2xhc3Nlcz8uZGVzY3JpcHRpb25cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIFwiPlxuICAgICAgICAgICAgICBAaWYgKGRlc2NyaXB0aW9uIHwgaXNTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICB7eyB0b2FzdCgpLmRlc2NyaXB0aW9uIH19XG4gICAgICAgICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgICAgICAgICpuZ0NvbXBvbmVudE91dGxldD1cIlxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiB8IGFzQ29tcG9uZW50O1xuICAgICAgICAgICAgICAgICAgICBpbnB1dHM6IHRvYXN0KCkuY29tcG9uZW50UHJvcHNcbiAgICAgICAgICAgICAgICAgIFwiIC8+XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIEBpZiAodG9hc3QoKS5jYW5jZWw7IGFzIGNhbmNlbCkge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIGRhdGEtYnV0dG9uXG4gICAgICAgICAgICBkYXRhLWNhbmNlbFxuICAgICAgICAgICAgW3N0eWxlXT1cImNhbmNlbEJ1dHRvblN0eWxlKCkgPz8gdG9hc3QoKS5jYW5jZWxCdXR0b25TdHlsZVwiXG4gICAgICAgICAgICBbY2xhc3NdPVwiY24oY2xhc3NlcygpLmNhbmNlbEJ1dHRvbiwgdG9hc3QoKS5jbGFzc2VzPy5jYW5jZWxCdXR0b24pXCJcbiAgICAgICAgICAgIChjbGljayk9XCJvbkNhbmNlbENsaWNrKClcIj5cbiAgICAgICAgICAgIHt7IGNhbmNlbC5sYWJlbCB9fVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICB9XG4gICAgICAgIEBpZiAodG9hc3QoKS5hY3Rpb247IGFzIGFjdGlvbikge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIGRhdGEtYnV0dG9uXG4gICAgICAgICAgICBbc3R5bGVdPVwiYWN0aW9uQnV0dG9uU3R5bGUoKSA/PyB0b2FzdCgpLmFjdGlvbkJ1dHRvblN0eWxlXCJcbiAgICAgICAgICAgIFtjbGFzc109XCJjbihjbGFzc2VzKCkuYWN0aW9uQnV0dG9uLCB0b2FzdCgpLmNsYXNzZXM/LmFjdGlvbkJ1dHRvbilcIlxuICAgICAgICAgICAgKGNsaWNrKT1cIm9uQWN0aW9uQ2xpY2soJGV2ZW50KVwiPlxuICAgICAgICAgICAge3sgYWN0aW9uLmxhYmVsIH19XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICA8L2xpPlxuICBgLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgVG9hc3RDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgY24gPSBjbjtcblxuICB0b2FzdHMgPSB0b2FzdFN0YXRlLnRvYXN0cztcbiAgaGVpZ2h0cyA9IHRvYXN0U3RhdGUuaGVpZ2h0cztcbiAgcmVtb3ZlSGVpZ2h0ID0gdG9hc3RTdGF0ZS5yZW1vdmVIZWlnaHQ7XG4gIGFkZEhlaWdodCA9IHRvYXN0U3RhdGUuYWRkSGVpZ2h0O1xuICBkaXNtaXNzID0gdG9hc3RTdGF0ZS5kaXNtaXNzO1xuXG4gIHRvYXN0ID0gaW5wdXQucmVxdWlyZWQ8VG9hc3RQcm9wc1sndG9hc3QnXT4oKTtcbiAgaW5kZXggPSBpbnB1dC5yZXF1aXJlZDxUb2FzdFByb3BzWydpbmRleCddPigpO1xuICBleHBhbmRlZCA9IGlucHV0LnJlcXVpcmVkPFRvYXN0UHJvcHNbJ2V4cGFuZGVkJ10+KCk7XG4gIF9pbnZlcnQgPSBpbnB1dC5yZXF1aXJlZDxUb2FzdFByb3BzWydpbnZlcnQnXT4oeyBhbGlhczogJ2ludmVydCcgfSk7XG4gIHBvc2l0aW9uID0gaW5wdXQucmVxdWlyZWQ8VG9hc3RQcm9wc1sncG9zaXRpb24nXT4oKTtcbiAgdmlzaWJsZVRvYXN0cyA9IGlucHV0LnJlcXVpcmVkPFRvYXN0UHJvcHNbJ3Zpc2libGVUb2FzdHMnXT4oKTtcbiAgZXhwYW5kQnlEZWZhdWx0ID0gaW5wdXQucmVxdWlyZWQ8VG9hc3RQcm9wc1snZXhwYW5kQnlEZWZhdWx0J10+KCk7XG4gIF9jbG9zZUJ1dHRvbiA9IGlucHV0LnJlcXVpcmVkPFRvYXN0UHJvcHNbJ2Nsb3NlQnV0dG9uJ10+KHtcbiAgICBhbGlhczogJ2Nsb3NlQnV0dG9uJyxcbiAgfSk7XG4gIGludGVyYWN0aW5nID0gaW5wdXQucmVxdWlyZWQ8VG9hc3RQcm9wc1snaW50ZXJhY3RpbmcnXT4oKTtcbiAgY2FuY2VsQnV0dG9uU3R5bGUgPSBpbnB1dDxUb2FzdFByb3BzWydjYW5jZWxCdXR0b25TdHlsZSddPigpO1xuICBhY3Rpb25CdXR0b25TdHlsZSA9IGlucHV0PFRvYXN0UHJvcHNbJ2FjdGlvbkJ1dHRvblN0eWxlJ10+KCk7XG4gIGR1cmF0aW9uID0gaW5wdXQ8VG9hc3RQcm9wc1snZHVyYXRpb24nXT4oVE9BU1RfTElGRVRJTUUpO1xuICBkZXNjcmlwdGlvbkNsYXNzID0gaW5wdXQ8VG9hc3RQcm9wc1snZGVzY3JpcHRpb25DbGFzcyddPignJyk7XG4gIF9jbGFzc2VzID0gaW5wdXQ8VG9hc3RQcm9wc1snY2xhc3NlcyddPih7fSwgeyBhbGlhczogJ2NsYXNzZXMnIH0pO1xuICB1bnN0eWxlZCA9IGlucHV0PFRvYXN0UHJvcHNbJ3Vuc3R5bGVkJ10+KGZhbHNlKTtcbiAgX2NsYXNzID0gaW5wdXQoJycsIHsgYWxpYXM6ICdjbGFzcycgfSk7XG4gIF9zdHlsZSA9IGlucHV0PFJlY29yZDxzdHJpbmcsIHN0cmluZz4+KHt9LCB7IGFsaWFzOiAnc3R5bGUnIH0pO1xuXG4gIG1vdW50ZWQgPSBzaWduYWwoZmFsc2UpO1xuICByZW1vdmVkID0gc2lnbmFsKGZhbHNlKTtcbiAgc3dpcGluZyA9IHNpZ25hbChmYWxzZSk7XG4gIHN3aXBlT3V0ID0gc2lnbmFsKGZhbHNlKTtcbiAgb2Zmc2V0QmVmb3JlUmVtb3ZlID0gc2lnbmFsKDApO1xuICBpbml0aWFsSGVpZ2h0ID0gc2lnbmFsKDApO1xuXG4gIHRvYXN0UmVmID0gdmlld0NoaWxkLnJlcXVpcmVkPEVsZW1lbnRSZWY8SFRNTExJRWxlbWVudD4+KCd0b2FzdFJlZicpO1xuXG4gIGNsYXNzZXM6IGFueSA9IGNvbXB1dGVkKCgpID0+ICh7XG4gICAgLi4uZGVmYXVsdENsYXNzZXMsXG4gICAgLi4udGhpcy5fY2xhc3NlcygpLFxuICB9KSk7XG5cbiAgaXNGcm9udCA9IGNvbXB1dGVkKCgpID0+IHRoaXMuaW5kZXgoKSA9PT0gMCk7XG4gIGlzVmlzaWJsZSA9IGNvbXB1dGVkKCgpID0+IHRoaXMuaW5kZXgoKSArIDEgPD0gdGhpcy52aXNpYmxlVG9hc3RzKCkpO1xuICB0b2FzdFR5cGUgPSBjb21wdXRlZCgoKSA9PiB0aGlzLnRvYXN0KCkudHlwZSA/PyAnZGVmYXVsdCcpO1xuICB0b2FzdENsYXNzID0gY29tcHV0ZWQoKCkgPT4gdGhpcy50b2FzdCgpLmNsYXNzID8/ICcnKTtcbiAgdG9hc3REZXNjcmlwdGlvbkNsYXNzID0gY29tcHV0ZWQoKCkgPT4gdGhpcy50b2FzdCgpLmRlc2NyaXB0aW9uQ2xhc3MgPz8gJycpO1xuXG4gIGhlaWdodEluZGV4ID0gY29tcHV0ZWQoKCkgPT5cbiAgICB0aGlzLmhlaWdodHMoKS5maW5kSW5kZXgoaGVpZ2h0ID0+IGhlaWdodC50b2FzdElkID09PSB0aGlzLnRvYXN0KCkuaWQpXG4gICk7XG5cbiAgb2Zmc2V0ID0gc2lnbmFsKDApO1xuXG4gIGNsb3NlVGltZXJTdGFydFRpbWVSZWYgPSAwO1xuICBsYXN0Q2xvc2VUaW1lclN0YXJ0VGltZVJlZiA9IDA7XG4gIHBvaW50ZXJTdGFydFJlZjogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHwgbnVsbCA9IG51bGw7XG5cbiAgY29vcmRzID0gY29tcHV0ZWQoKCkgPT4gdGhpcy5wb3NpdGlvbigpLnNwbGl0KCctJykpO1xuICB0b2FzdHNIZWlnaHRCZWZvcmUgPSBjb21wdXRlZCgoKSA9PlxuICAgIHRoaXMuaGVpZ2h0cygpLnJlZHVjZSgocHJldiwgY3VyciwgcmVkdWNlckluZGV4KSA9PiB7XG4gICAgICBpZiAocmVkdWNlckluZGV4ID49IHRoaXMuaGVpZ2h0SW5kZXgoKSkgcmV0dXJuIHByZXY7XG4gICAgICByZXR1cm4gcHJldiArIGN1cnIuaGVpZ2h0O1xuICAgIH0sIDApXG4gICk7XG4gIGludmVydCA9IGNvbXB1dGVkKCgpID0+IHRoaXMudG9hc3QoKS5pbnZlcnQgPz8gdGhpcy5faW52ZXJ0KCkpO1xuICBjbG9zZUJ1dHRvbiA9IGNvbXB1dGVkKCgpID0+IHRoaXMudG9hc3QoKS5jbG9zZUJ1dHRvbiA/PyB0aGlzLl9jbG9zZUJ1dHRvbigpKTtcbiAgZGlzYWJsZWQgPSBjb21wdXRlZCgoKSA9PiB0aGlzLnRvYXN0VHlwZSgpID09PSAnbG9hZGluZycpO1xuXG4gIHRpbWVvdXRJZDogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD4gfCB1bmRlZmluZWQ7XG4gIHJlbWFpbmluZ1RpbWUgPSAwO1xuXG4gIGlzUHJvbWlzZUxvYWRpbmdPckluZmluaXRlRHVyYXRpb24gPSBjb21wdXRlZChcbiAgICAoKSA9PlxuICAgICAgKHRoaXMudG9hc3QoKS5wcm9taXNlICYmIHRoaXMudG9hc3RUeXBlKCkgPT09ICdsb2FkaW5nJykgfHxcbiAgICAgIHRoaXMudG9hc3QoKS5kdXJhdGlvbiA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZXG4gICk7XG5cbiAgdG9hc3RDbGFzc2VzID0gY29tcHV0ZWQoKCkgPT5cbiAgICBjbihcbiAgICAgIHRoaXMuX2NsYXNzKCksXG4gICAgICB0aGlzLnRvYXN0Q2xhc3MoKSxcbiAgICAgIHRoaXMuY2xhc3NlcygpLnRvYXN0LFxuICAgICAgdGhpcy50b2FzdCgpLmNsYXNzZXM/LnRvYXN0LFxuICAgICAgdGhpcy5jbGFzc2VzKClbdGhpcy50b2FzdFR5cGUoKV0sXG4gICAgICB0aGlzLnRvYXN0KCkuY2xhc3Nlcz8uW3RoaXMudG9hc3RUeXBlKCldXG4gICAgKVxuICApO1xuICB0b2FzdFN0eWxlID0gY29tcHV0ZWQoKCkgPT4gKHtcbiAgICAnLS1pbmRleCc6IGAke3RoaXMuaW5kZXgoKX1gLFxuICAgICctLXRvYXN0cy1iZWZvcmUnOiBgJHt0aGlzLmluZGV4KCl9YCxcbiAgICAnLS16LWluZGV4JzogYCR7dGhpcy50b2FzdHMoKS5sZW5ndGggLSB0aGlzLmluZGV4KCl9YCxcbiAgICAnLS1vZmZzZXQnOiBgJHt0aGlzLnJlbW92ZWQoKSA/IHRoaXMub2Zmc2V0QmVmb3JlUmVtb3ZlKCkgOiB0aGlzLm9mZnNldCgpfXB4YCxcbiAgICAnLS1pbml0aWFsLWhlaWdodCc6IHRoaXMuZXhwYW5kQnlEZWZhdWx0KClcbiAgICAgID8gJ2F1dG8nXG4gICAgICA6IGAke3RoaXMuaW5pdGlhbEhlaWdodCgpfXB4YCxcbiAgICAuLi50aGlzLl9zdHlsZSgpLFxuICB9KSk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgZWZmZWN0KCgpID0+IHtcbiAgICAgIGNvbnN0IGhlaWdodEluZGV4ID0gdGhpcy5oZWlnaHRJbmRleCgpO1xuICAgICAgY29uc3QgdG9hc3RzSGVpZ2h0QmVmb3JlID0gdGhpcy50b2FzdHNIZWlnaHRCZWZvcmUoKTtcbiAgICAgIHVudHJhY2tlZCgoKSA9PlxuICAgICAgICB0aGlzLm9mZnNldC5zZXQoTWF0aC5yb3VuZChoZWlnaHRJbmRleCAqIEdBUCArIHRvYXN0c0hlaWdodEJlZm9yZSkpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgZWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnRvYXN0KCkudXBkYXRlZCkge1xuICAgICAgICAvLyBpZiB0aGUgdG9hc3QgaGFzIGJlZW4gdXBkYXRlZCBhZnRlciB0aGUgaW5pdGlhbCByZW5kZXIsXG4gICAgICAgIC8vIHdlIHdhbnQgdG8gcmVzZXQgdGhlIHRpbWVyIGFuZCBzZXQgdGhlIHJlbWFpbmluZyB0aW1lIHRvIHRoZVxuICAgICAgICAvLyBuZXcgZHVyYXRpb25cbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTtcbiAgICAgICAgdGhpcy5yZW1haW5pbmdUaW1lID1cbiAgICAgICAgICB0aGlzLnRvYXN0KCkuZHVyYXRpb24gPz8gdGhpcy5kdXJhdGlvbigpID8/IFRPQVNUX0xJRkVUSU1FO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZXIoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGVmZmVjdChvbkNsZWFudXAgPT4ge1xuICAgICAgaWYgKCF0aGlzLmlzUHJvbWlzZUxvYWRpbmdPckluZmluaXRlRHVyYXRpb24oKSkge1xuICAgICAgICBpZiAodGhpcy5leHBhbmRlZCgpIHx8IHRoaXMuaW50ZXJhY3RpbmcoKSkge1xuICAgICAgICAgIHRoaXMucGF1c2VUaW1lcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc3RhcnRUaW1lcigpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIG9uQ2xlYW51cCgoKSA9PiBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SWQpKTtcbiAgICB9KTtcblxuICAgIGVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy50b2FzdCgpLmRlbGV0ZSkge1xuICAgICAgICB0aGlzLmRlbGV0ZVRvYXN0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5yZW1haW5pbmdUaW1lID1cbiAgICAgIHRoaXMudG9hc3QoKS5kdXJhdGlvbiA/PyB0aGlzLmR1cmF0aW9uKCkgPz8gVE9BU1RfTElGRVRJTUU7XG4gICAgdGhpcy5tb3VudGVkLnNldCh0cnVlKTtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLnRvYXN0UmVmKCkubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgdGhpcy5pbml0aWFsSGVpZ2h0LnNldChoZWlnaHQpO1xuICAgIHRoaXMuYWRkSGVpZ2h0KHsgdG9hc3RJZDogdGhpcy50b2FzdCgpLmlkLCBoZWlnaHQgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SWQpO1xuICAgIHRoaXMucmVtb3ZlSGVpZ2h0KHRoaXMudG9hc3QoKS5pZCk7XG4gIH1cblxuICBkZWxldGVUb2FzdCgpIHtcbiAgICB0aGlzLnJlbW92ZWQuc2V0KHRydWUpO1xuICAgIHRoaXMub2Zmc2V0QmVmb3JlUmVtb3ZlLnNldCh0aGlzLm9mZnNldCgpKTtcblxuICAgIHRoaXMucmVtb3ZlSGVpZ2h0KHRoaXMudG9hc3QoKS5pZCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZGlzbWlzcyh0aGlzLnRvYXN0KCkuaWQpO1xuICAgIH0sIFRJTUVfQkVGT1JFX1VOTU9VTlQpO1xuICB9XG5cbiAgLy8gSWYgdG9hc3QncyBkdXJhdGlvbiBjaGFuZ2VzLCBpdCB3aWxsIGJlIG91dCBvZiBzeW5jIHdpdGggdGhlXG4gIC8vIHJlbWFpbmluZ0F0VGltZW91dCwgc28gd2Uga25vdyB3ZSBuZWVkIHRvIHJlc3RhcnQgdGhlIHRpbWVyXG4gIC8vIHdpdGggdGhlIG5ldyBkdXJhdGlvblxuXG4gIC8vIFBhdXNlIHRoZSB0aW1lciBvbiBlYWNoIGhvdmVyXG4gIHBhdXNlVGltZXIoKSB7XG4gICAgaWYgKHRoaXMubGFzdENsb3NlVGltZXJTdGFydFRpbWVSZWYgPCB0aGlzLmNsb3NlVGltZXJTdGFydFRpbWVSZWYpIHtcbiAgICAgIC8vIEdldCB0aGUgZWxhcHNlZCB0aW1lIHNpbmNlIHRoZSB0aW1lciBzdGFydGVkXG4gICAgICBjb25zdCBlbGFwc2VkVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5jbG9zZVRpbWVyU3RhcnRUaW1lUmVmO1xuICAgICAgdGhpcy5yZW1haW5pbmdUaW1lID0gdGhpcy5yZW1haW5pbmdUaW1lIC0gZWxhcHNlZFRpbWU7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0Q2xvc2VUaW1lclN0YXJ0VGltZVJlZiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB9XG5cbiAgc3RhcnRUaW1lcigpIHtcbiAgICB0aGlzLmNsb3NlVGltZXJTdGFydFRpbWVSZWYgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAvLyBMZXQgdGhlIHRvYXN0IGtub3cgaXQgaGFzIHN0YXJ0ZWRcbiAgICB0aGlzLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy50b2FzdCgpLm9uQXV0b0Nsb3NlPy4odGhpcy50b2FzdCgpKTtcbiAgICAgIHRoaXMuZGVsZXRlVG9hc3QoKTtcbiAgICB9LCB0aGlzLnJlbWFpbmluZ1RpbWUpO1xuICB9XG5cbiAgb25Qb2ludGVyRG93bihldmVudDogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQoKSB8fCAhdGhpcy50b2FzdCgpLmRpc21pc3NpYmxlKSByZXR1cm47XG5cbiAgICB0aGlzLm9mZnNldEJlZm9yZVJlbW92ZS5zZXQodGhpcy5vZmZzZXQoKSk7XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgIC8vIEVuc3VyZSB3ZSBtYWludGFpbiBjb3JyZWN0IHBvaW50ZXIgY2FwdHVyZSBldmVuIHdoZW4gZ29pbmcgb3V0c2lkZSB0aGUgdG9hc3QgKGUuZy4gd2hlbiBzd2lwaW5nKVxuICAgIHRhcmdldC5zZXRQb2ludGVyQ2FwdHVyZShldmVudC5wb2ludGVySWQpO1xuICAgIGlmICh0YXJnZXQudGFnTmFtZSA9PT0gJ0JVVFRPTicpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zd2lwaW5nLnNldCh0cnVlKTtcbiAgICB0aGlzLnBvaW50ZXJTdGFydFJlZiA9IHsgeDogZXZlbnQuY2xpZW50WCwgeTogZXZlbnQuY2xpZW50WSB9O1xuICB9XG5cbiAgb25Qb2ludGVyVXAoKSB7XG4gICAgaWYgKHRoaXMuc3dpcGVPdXQoKSB8fCAhdGhpcy50b2FzdCgpLmRpc21pc3NpYmxlKSByZXR1cm47XG5cbiAgICB0aGlzLnBvaW50ZXJTdGFydFJlZiA9IG51bGw7XG4gICAgY29uc3Qgc3dpcGVBbW91bnQgPSBOdW1iZXIoXG4gICAgICB0aGlzLnRvYXN0UmVmKClcbiAgICAgICAgLm5hdGl2ZUVsZW1lbnQuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS1zd2lwZS1hbW91bnQnKVxuICAgICAgICAucmVwbGFjZSgncHgnLCAnJykgfHwgMFxuICAgICk7XG5cbiAgICAvLyBSZW1vdmUgb25seSBpZiB0aHJlc2hvbGQgaXMgbWV0XG4gICAgaWYgKE1hdGguYWJzKHN3aXBlQW1vdW50KSA+PSBTV0lQRV9USFJFU0hPTEQpIHtcbiAgICAgIHRoaXMub2Zmc2V0QmVmb3JlUmVtb3ZlLnNldCh0aGlzLm9mZnNldCgpKTtcbiAgICAgIHRoaXMudG9hc3QoKS5vbkRpc21pc3M/Lih0aGlzLnRvYXN0KCkpO1xuICAgICAgdGhpcy5kZWxldGVUb2FzdCgpO1xuICAgICAgdGhpcy5zd2lwZU91dC5zZXQodHJ1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy50b2FzdFJlZigpLm5hdGl2ZUVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tc3dpcGUtYW1vdW50JywgJzBweCcpO1xuICAgIHRoaXMuc3dpcGluZy5zZXQoZmFsc2UpO1xuICB9XG5cbiAgb25Qb2ludGVyTW92ZShldmVudDogUG9pbnRlckV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLnBvaW50ZXJTdGFydFJlZiB8fCAhdGhpcy50b2FzdCgpLmRpc21pc3NpYmxlKSByZXR1cm47XG5cbiAgICBjb25zdCB5UG9zaXRpb24gPSBldmVudC5jbGllbnRZIC0gdGhpcy5wb2ludGVyU3RhcnRSZWYueTtcbiAgICBjb25zdCB4UG9zaXRpb24gPSBldmVudC5jbGllbnRYIC0gdGhpcy5wb2ludGVyU3RhcnRSZWYueDtcblxuICAgIGNvbnN0IGNsYW1wID0gdGhpcy5jb29yZHMoKVswXSA9PT0gJ3RvcCcgPyBNYXRoLm1pbiA6IE1hdGgubWF4O1xuICAgIGNvbnN0IGNsYW1wZWRZID0gY2xhbXAoMCwgeVBvc2l0aW9uKTtcbiAgICBjb25zdCBzd2lwZVN0YXJ0VGhyZXNob2xkID0gZXZlbnQucG9pbnRlclR5cGUgPT09ICd0b3VjaCcgPyAxMCA6IDI7XG4gICAgY29uc3QgaXNBbGxvd2VkVG9Td2lwZSA9IE1hdGguYWJzKGNsYW1wZWRZKSA+IHN3aXBlU3RhcnRUaHJlc2hvbGQ7XG5cbiAgICBpZiAoaXNBbGxvd2VkVG9Td2lwZSkge1xuICAgICAgdGhpcy50b2FzdFJlZigpLm5hdGl2ZUVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoXG4gICAgICAgICctLXN3aXBlLWFtb3VudCcsXG4gICAgICAgIGAke3lQb3NpdGlvbn1weGBcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChNYXRoLmFicyh4UG9zaXRpb24pID4gc3dpcGVTdGFydFRocmVzaG9sZCkge1xuICAgICAgLy8gVXNlciBpcyBzd2lwaW5nIGluIHdyb25nIGRpcmVjdGlvbiwgc28gd2UgZGlzYWJsZSBzd2lwZSBnZXN0dXJlXG4gICAgICAvLyBmb3IgdGhlIGN1cnJlbnQgcG9pbnRlciBkb3duIGludGVyYWN0aW9uXG4gICAgICB0aGlzLnBvaW50ZXJTdGFydFJlZiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgb25DbG9zZUJ1dHRvbkNsaWNrKCkge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKCkgfHwgIXRoaXMudG9hc3QoKS5kaXNtaXNzaWJsZSkgcmV0dXJuO1xuICAgIHRoaXMuZGVsZXRlVG9hc3QoKTtcbiAgICB0aGlzLnRvYXN0KCkub25EaXNtaXNzPy4odGhpcy50b2FzdCgpKTtcbiAgfVxuXG4gIG9uQ2FuY2VsQ2xpY2soKSB7XG4gICAgY29uc3QgdG9hc3QgPSB0aGlzLnRvYXN0KCk7XG4gICAgaWYgKCF0b2FzdC5kaXNtaXNzaWJsZSkgcmV0dXJuO1xuICAgIHRoaXMuZGVsZXRlVG9hc3QoKTtcbiAgICBpZiAodG9hc3QuY2FuY2VsPy5vbkNsaWNrKSB7XG4gICAgICB0b2FzdC5jYW5jZWwub25DbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIG9uQWN0aW9uQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCB0b2FzdCA9IHRoaXMudG9hc3QoKTtcbiAgICB0b2FzdC5hY3Rpb24/Lm9uQ2xpY2soZXZlbnQpO1xuICAgIGlmIChldmVudC5kZWZhdWx0UHJldmVudGVkKSByZXR1cm47XG4gICAgdGhpcy5kZWxldGVUb2FzdCgpO1xuICB9XG59XG4iXX0=